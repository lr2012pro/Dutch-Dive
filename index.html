<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duik in het Nederlands</title>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>
    <style>
        /* Importeren van een modern en leesbaar lettertype */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        /* Algemene stijlen voor de body en de lay-out */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f4f8; /* Zachte achtergrondkleur */
            color: #333; /* Donkergrijze tekstkleur */
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Container voor de gehele app */
        .container {
            max-width: 900px;
            width: 100%;
            margin: auto;
            background-color: #fff; /* Witte achtergrond voor de container */
            padding: 30px;
            border-radius: 16px; /* Afgeronde hoeken */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); /* Zachte schaduw */
        }

        /* Stijlen voor de header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        /* Hoofdtitel van de app */
        h1 {
            color: #1a237e; /* Donkerblauwe titelkleur */
            font-weight: 600;
            font-size: 2.5em;
            margin: 0;
        }

        /* Stijlen voor de puntenweergave */
        #points-display {
            background-color: #4caf50; /* Groene achtergrond */
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1.2em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
        }

        #points-display span {
            margin-left: 8px;
        }

        /* Sectie container voor quiz en winkel */
        .section {
            background-color: #e8f5e9; /* Zachtgroene achtergrond */
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        /* Titels van de secties */
        .section-title {
            color: #2e7d32; /* Donkergroene titelkleur */
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* Stijlen voor individuele quizvragen */
        .quiz-item {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .quiz-item label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        /* Stijlen voor tekstinvoervelden */
        input[type="text"] {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #4caf50; /* Groene rand bij focus */
        }

        /* Feedback berichten na controle */
        .feedback {
            font-weight: bold;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .correct {
            color: #2e7d32; /* Groene kleur voor correct */
        }

        .incorrect {
            color: #d32f2f; /* Rode kleur voor incorrect */
        }

        /* Algemene stijlen voor knoppen */
        button {
            background-color: #1a237e; /* Donkerblauwe achtergrond */
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover {
            background-color: #0d1b54;
            transform: translateY(-2px); /* Lichte opwaartse beweging */
        }

        /* Stijlen voor de winkelitems */
        .shop-item {
            border: 1px solid #e0e0e0;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shop-item h3 {
            margin: 0;
            color: #1a237e;
        }

        .unlocked {
            color: #2e7d32;
            font-style: italic;
            font-weight: 600;
        }

        /* Lay-out voor de categoriknoppen */
        .category-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .category-buttons button {
            width: 100%;
        }

        /* Knoppen onder de quiz */
        #task-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        /* Modale pop-up voor berichten */
        #message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            border: 2px solid #1a237e;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            max-width: 80%;
            display: none;
        }

        #message-box h3 {
            margin-top: 0;
            color: #1a237e;
        }

        #message-box p {
            margin-bottom: 20px;
        }

        #message-box-close {
            background-color: #ff9800;
            padding: 8px 16px;
        }

        #message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        /* Stijlen voor de ontgrendelde items sectie */
        #unlocked-items-section {
            display: none; /* Standaard verborgen */
            padding: 25px;
            background-color: #fce4ec; /* Roze achtergrond */
            border-radius: 12px;
            margin-top: 25px;
        }

        #unlocked-items-section h2 {
            color: #ad1457;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Duik in het Nederlands</h1>
            <div id="points-display">
                <span class="emoji">‚≠ê</span>
                <span id="points-value">0</span> punten
            </div>
        </header>
        <p>Gebruikers-ID: <span id="user-id">Laden...</span></p>
        <p>Je voortgang wordt automatisch opgeslagen met deze ID. Je hebt geen wachtwoord nodig!</p>

        <div class="section">
            <h2 class="section-title" id="task-title">Begin een taak!</h2>
            <p id="task-description">Klik op een categorie om te beginnen met oefenen!</p>

            <div id="category-selection">
                <div class="category-buttons">
                    <button onclick="startNewTask('tt')">Tegenwoordige Tijd</button>
                    <button onclick="startNewTask('vt')">Verleden Tijd</button>
                    <button onclick="startNewTask('vd')">Voltooid Deelwoord</button>
                    <button onclick="startNewTask('voorzetsels')">Voorzetsels</button>
                    <button onclick="startNewTask('zinsontleding')">Zinsontleding</button>
                    <button onclick="startNewTask('spelling')">Spelling</button>
                    <button onclick="startNewTask('meervoud')">Meervoud</button>
                    <button onclick="startNewTask('verkleinwoorden')">Verkleinwoorden</button>
                    <button onclick="startNewTask('idiomen')">Idiomen</button>
                    <button onclick="startNewTask('woordsoorten')">Woordsoorten</button>
                    <button onclick="startNewTask('ontkenningen')">Ontkenningen</button>
                </div>
            </div>

            <div id="task-content" style="display:none;">
                <!-- Dynamische inhoud wordt hier geladen -->
            </div>
            
            <div id="task-buttons" style="display:none;">
                <button id="check-button" onclick="checkCurrentTask()">Controleer Antwoorden</button>
                <button id="new-task-btn" onclick="showCategorySelection()">Terug naar categorie√´n</button>
            </div>
        </div>

        <hr>

        <div class="section">
            <h2 class="section-title">Winkel (Shop) üõçÔ∏è</h2>
            <p>Geef je punten uit aan leuke dingen!</p>
            <div class="shop-item">
                <div>
                    <h3>Digitale Badge "Grammatica Expert" üñãÔ∏è</h3>
                    <p>Kosten: 5 punten</p>
                </div>
                <button id="buy-badge-btn" onclick="buyItem('badge', 5)">Koop</button>
                <span id="badge-status"></span>
            </div>
            <div class="shop-item">
                <div>
                    <h3>Nederlandse Mop üòÇ</h3>
                    <p>Kosten: 3 punten</p>
                </div>
                <button id="buy-joke-btn" onclick="buyItem('joke', 3)">Koop</button>
                <p id="joke-content" style="display: none;"></p>
            </div>
            <div class="shop-item">
                <div>
                    <h3>Punten-Verdubbelaar üöÄ</h3>
                    <p>Kosten: 10 punten</p>
                </div>
                <button id="buy-doubler-btn" onclick="buyItem('doubler', 10)">Koop</button>
                <span id="doubler-status"></span>
            </div>
            <div class="shop-item">
                <div>
                    <h3>Virtuele Sticker "Goed Bezig!" üèÖ</h3>
                    <p>Kosten: 2 punten</p>
                </div>
                <button id="buy-sticker-btn" onclick="buyItem('sticker', 2)">Koop</button>
                <span id="sticker-status"></span>
            </div>
            <div class="shop-item">
                <div>
                    <h3>Bonus Vraag üí°</h3>
                    <p>Kosten: 8 punten (Verdien 20 punten!)</p>
                </div>
                <button id="buy-bonus-btn" onclick="buyItem('bonus_question', 8)">Koop</button>
                <span id="bonus-status"></span>
            </div>
        </div>

        <div id="unlocked-items-section">
            <h2 class="section-title">Jouw Ontgrendelde Items</h2>
            <ul id="unlocked-items-list">
                <!-- Ontgrendelde items worden hier dynamisch toegevoegd -->
            </ul>
        </div>
    </div>
    
    <div id="message-box-overlay"></div>
    <div id="message-box">
        <h3 id="message-box-title"></h3>
        <p id="message-box-text"></p>
        <button id="message-box-close" onclick="closeMessageBox()">Sluiten</button>
    </div>

    <script type="module">
        // Import necessary Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase and user state variables
        let app;
        let db;
        let auth;
        let userId = null;
        let userDocRef = null;
        let isAuthReady = false;

        // Game state variables
        let points = 0;
        let badgeUnlocked = false;
        let jokeUnlocked = false;
        let pointDoublerStacks = 0;
        let stickerUnlocked = false;
        let bonusQuestionUnlocked = false;
        let unlockedItems = [];
        let currentTaskAnswers = null;
        let currentTaskInputs = [];

        // Extensive quiz data for dynamic quiz generation
        const quizData = {
            'tt': { // Tegenwoordige tijd (Present Tense)
                title: "Spelling: Werkwoorden (tegenwoordige tijd)",
                description: "Spel de werkwoorden in de tegenwoordige tijd (tt).",
                verbstems: [
                    'fietsen', 'lopen', 'denken', 'praten', 'voelen', 'schrijven', 'lezen', 'zien', 'drinken', 'horen',
                    'werken', 'geven', 'nemen', 'komen', 'gaan', 'willen', 'kunnen', 'moeten', 'durven', 'weten',
                    'zeggen', 'doen', 'eindigen', 'slapen', 'brengen', 'vinden', 'helpen', 'krijgen', 'zitten', 'staan',
                    'rijden', 'vergeten', 'ontmoeten', 'spelen', 'bouwen', 'dansen', 'sluiten', 'groeien', 'spreken', 'vragen',
                    'verkopen', 'zwemmen', 'houden', 'wassen', 'eten', 'kijken', 'verliezen', 'vertellen', 'bloeien', 'kopen',
                    'reizen', 'leiden', 'werken', 'wonen', 'zitten', 'vertellen', 'begrijpen', 'vinden', 'eten', 'drinken',
                    'zorgen', 'bouwen', 'reizen', 'zingen', 'slapen', 'dansen', 'sluiten', 'groeien', 'spreken', 'vragen',
                    'verkopen', 'verliezen', 'zwemmen', 'houden', 'wassen', 'eten', 'kijken', 'verliezen', 'vertellen', 'bloeien',
                    'kopen', 'lachen', 'huilen', 'springen', 'vliegen', 'vechten', 'vegen', 'weten', 'willen', 'dwingen',
                    'vallen', 'zenden', 'verklaren', 'beloven', 'bezoeken', 'schrikken', 'zwijgen', 'verhuizen', 'uitgaan', 'opstaan'
                ]
            },
            'vt': { // Verleden tijd (Past Tense)
                title: "Spelling: Werkwoorden (verleden tijd)",
                description: "Vul de correcte verleden tijd in.",
                verbs: [
                    { inf: 'reizen', vt: 'reisde' }, { inf: 'kijken', vt: 'keek' }, { inf: 'eten', vt: 'aten' },
                    { inf: 'slapen', vt: 'sliep' }, { inf: 'rennen', vt: 'renden' }, { inf: 'stoppen', vt: 'stopte' },
                    { inf: 'vinden', vt: 'vond' }, { inf: 'zijn', vt: 'was' }, { inf: 'willen', vt: 'wilden' },
                    { inf: 'gaan', vt: 'ging' }, { inf: 'weten', vt: 'wisten' }, { inf: 'moeten', vt: 'moesten' },
                    { inf: 'lopen', vt: 'liep' }, { inf: 'drinken', vt: 'dronken' }, { inf: 'vliegen', vt: 'vlogen' },
                    { inf: 'brengen', vt: 'bracht' }, { inf: 'verliezen', vt: 'verloor' }, { inf: 'vertellen', vt: 'vertelde' },
                    { inf: 'voelen', vt: 'voelden' }, { inf: 'bloeien', vt: 'bloeide' }, { inf: 'kopen', vt: 'kocht' },
                    { inf: 'zeggen', vt: 'zei' }, { inf: 'doen', vt: 'deed' }, { inf: 'horen', vt: 'hoorde' },
                    { inf: 'vragen', vt: 'vroeg' }, { inf: 'maken', vt: 'maakte' }, { inf: 'schrijven', vt: 'schreef' },
                    { inf: 'beginnen', vt: 'begonnen' }, { inf: 'helpen', vt: 'hielpen' }, { inf: 'krijgen', vt: 'kreeg' },
                    { inf: 'denken', vt: 'dacht' }, { inf: 'zitten', vt: 'zat' }, { inf: 'staan', vt: 'stond' },
                    { inf: 'geven', vt: 'gaf' }, { inf: 'lezen', vt: 'las' }, { inf: 'zwemmen', vt: 'zwommen' },
                    { inf: 'houden', vt: 'hield' }, { inf: 'wassen', vt: 'waste' }, { inf: 'bouwen', vt: 'bouwde' },
                    { inf: 'rijden', vt: 'reed' }, { inf: 'vergeten', vt: 'vergat' }, { inf: 'ontmoeten', vt: 'ontmoette' },
                    { inf: 'spelen', vt: 'speelde' }, { inf: 'bouwen', vt: 'bouwden' }, { inf: 'dansen', vt: 'danste' },
                    { inf: 'sluiten', vt: 'sloot' }, { inf: 'groeien', vt: 'groeide' }, { inf: 'spreken', vt: 'sprak' },
                    { inf: 'verkopen', vt: 'verkocht' }, { inf: 'zien', vt: 'zag' }, { inf: 'zwemmen', vt: 'zwom' },
                    { inf: 'vechten', vt: 'vocht' }, { inf: 'vegen', vt: 'veegde' }, { inf: 'vallen', vt: 'viel' },
                    { inf: 'zenden', vt: 'zond' }, { inf: 'verklaren', vt: 'verklaarde' }, { inf: 'beloven', vt: 'beloofde' },
                    { inf: 'bezoeken', vt: 'bezocht' }, { inf: 'schrikken', vt: 'schrok' }, { inf: 'verhuizen', vt: 'verhuisde' },
                    { inf: 'uitgaan', vt: 'ging uit' }, { inf: 'opstaan', vt: 'stond op' }, { inf: 'winnen', vt: 'won' },
                    { inf: 'verliezen', vt: 'verloor' }, { inf: 'kennen', vt: 'kende' }, { inf: 'kiezen', vt: 'koos' },
                    { inf: 'lijden', vt: 'leed' }, { inf: 'schijnen', vt: 'scheen' }, { inf: 'snijden', vt: 'sneed' },
                    { inf: 'sluiten', vt: 'sloot' }, { inf: 'stelen', vt: 'stal' }, { inf: 'trekken', vt: 'trok' },
                    { inf: 'vriezen', vt: 'vroor' }, { inf: 'weten', vt: 'wist' }, { inf: 'wijzen', vt: 'wees' }
                ]
            },
            'vd': { // Voltooid Deelwoord (Past Participle)
                title: "Grammatica: Voltooid Deelwoord",
                description: "Vul het correcte voltooid deelwoord in.",
                verbs: [
                    { inf: 'vinden', vd: 'gevonden' }, { inf: 'openen', vd: 'geopend' },
                    { inf: 'lopen', vd: 'gelopen' }, { inf: 'vangen', vd: 'gevangen' },
                    { inf: 'lezen', vd: 'gelezen' }, { inf: 'geven', vd: 'gegeven' },
                    { inf: 'gaan', vd: 'gegaan' }, { inf: 'zingen', vd: 'gezongen' },
                    { inf: 'verliezen', vd: 'verloren' }, { inf: 'wassen', vd: 'gewassen' },
                    { inf: 'klimmen', vd: 'geklommen' }, { inf: 'schrijven', vd: 'geschreven' },
                    { inf: 'spelen', vd: 'gespeeld' }, { inf: 'uitleggen', vd: 'uitgelegd' },
                    { inf: 'eten', vd: 'gegeten' }, { inf: 'schilderen', vd: 'geschilderd' },
                    { inf: 'brengen', vd: 'gebracht' }, { inf: 'vouwen', vd: 'gevouwen' },
                    { inf: 'bakken', vd: 'gebakken' }, { inf: 'praten', vd: 'gepraat' },
                    { inf: 'werken', vd: 'gewerkt' }, { inf: 'kopen', vd: 'gekocht' },
                    { inf: 'zijn', vd: 'geweest' }, { inf: 'doen', vd: 'gedaan' },
                    { inf: 'spreken', vd: 'gesproken' }, { inf: 'vragen', vd: 'gevraagd' },
                    { inf: 'helpen', vd: 'geholpen' }, { inf: 'houden', vd: 'gehouden' },
                    { inf: 'verkopen', vd: 'verkocht' }, { inf: 'zien', vd: 'gezien' },
                    { inf: 'zwemmen', vd: 'gezwommen' }, { inf: 'schrijven', vd: 'geschreven' },
                    { inf: 'beginnen', vd: 'begonnen' }, { inf: 'weten', vd: 'geweten' },
                    { inf: 'verliezen', vd: 'verloren' }, { inf: 'betalen', vd: 'betaald' },
                    { inf: 'bouwen', vd: 'gebouwd' }, { inf: 'kennen', vd: 'gekend' },
                    { inf: 'rijden', vd: 'gereden' }, { inf: 'groeien', vd: 'gegroeid' },
                    { inf: 'vallen', vd: 'gevallen' }, { inf: 'staan', vd: 'gestaan' },
                    { inf: 'verhuizen', vd: 'verhuisd' }, { inf: 'opstaan', vd: 'opgestaan' },
                    { inf: 'winnen', vd: 'gewonnen' }, { inf: 'verstoppen', vd: 'verstopt' },
                    { inf: 'verhuizen', vd: 'verhuisd' }, { inf: 'leiden', vd: 'geleid' },
                    { inf: 'kiezen', vd: 'gekozen' }, { inf: 'dansen', vd: 'gedanst' },
                    { inf: 'schilderen', vd: 'geschilderd' }, { inf: 'vergeten', vd: 'vergeten' },
                    { inf: 'drinken', vd: 'gedronken' }, { inf: 'liegen', vd: 'gelogen' },
                    { inf: 'rijden', vd: 'gereden' }, { inf: 'stelen', vd: 'gestolen' },
                    { inf: 'wensen', vd: 'gewenst' }, { inf: 'luisteren', vd: 'geluisterd' },
                    { inf: 'ontmoeten', vd: 'ontmoet' }, { inf: 'verstaan', vd: 'verstaan' },
                    { inf: 'voelen', vd: 'gevoeld' }, { inf: 'huilen', vd: 'gehuild' },
                    { inf: 'slapen', vd: 'geslapen' }, { inf: 'vriezen', vd: 'gevroren' },
                    { inf: 'branden', vd: 'gebrand' }, { inf: 'bouwen', vd: 'gebouwd' }
                ]
            },
            'voorzetsels': { // Prepositions
                title: "Grammatica: Voorzetsels",
                description: "Vul het correcte voorzetsel in.",
                sentences: [
                    { question: "De pen ligt ... de tafel.", answer: "op" },
                    { question: "Ik ga ... school.", answer: "naar" },
                    { question: "De bal rolt ... de stoel.", answer: "onder" },
                    { question: "We zitten ... de bank.", answer: "op" },
                    { question: "Hij loopt ... het huis.", answer: "om" },
                    { question: "De kat springt ... de doos.", answer: "in" },
                    { question: "De lamp hangt ... het bed.", answer: "boven" },
                    { question: "De auto staat ... de garage.", answer: "in" },
                    { question: "Het boek valt ... de kast.", answer: "uit" },
                    { question: "Ik kijk ... het raam.", answer: "uit" },
                    { question: "Zij woont ... Amsterdam.", answer: "in" },
                    { question: "De boot vaart ... het kanaal.", answer: "op" },
                    { question: "De kinderen spelen ... de speeltuin.", answer: "in" },
                    { question: "We eten ... de keuken.", answer: "in" },
                    { question: "De vogel vliegt ... de bomen.", answer: "tussen" },
                    { question: "De hond ligt ... de mand.", answer: "in" },
                    { question: "Zij schreef een brief ... haar vriendin.", answer: "aan" },
                    { question: "Ik ga ... een reis.", answer: "op" },
                    { question: "De trein rijdt ... het station.", answer: "naar" },
                    { question: "Het vliegtuig vliegt ... de wolken.", answer: "door" },
                    { question: "Hij is bang ... spinnen.", answer: "voor" },
                    { question: "Ik heb zin ... pizza.", answer: "in" },
                    { question: "De leraar vertelde ... de geschiedenis van de stad.", answer: "over" },
                    { question: "We hebben het ... het weer.", answer: "over" },
                    { question: "Hij wacht ... de bus.", answer: "op" },
                    { question: "Zij is verliefd ... hem.", answer: "op" },
                    { question: "De schoenen staan ... de deur.", answer: "bij" },
                    { question: "Ik ben klaar ... de test.", answer: "met" },
                    { question: "Zij kijkt ... hem.", answer: "naar" },
                    { question: "Hij denkt ... zijn toekomst.", answer: "aan" },
                    { question: "De bloemen zijn ... de tuin.", answer: "uit" },
                    { question: "We lopen ... de straat.", answer: "door" },
                    { question: "Hij is ... huis.", answer: "thuis" },
                    { question: "De auto staat ... het stoplicht.", answer: "bij" },
                    { question: "Ik ben trots ... jou.", answer: "op" },
                    { question: "Hij praat ... zijn werk.", answer: "over" },
                    { question: "De beker is gemaakt ... glas.", answer: "van" },
                    { question: "Ik werk ... een nieuw project.", answer: "aan" },
                    { question: "De sleutel is ... de deur.", answer: "in" },
                    { question: "Zij heeft talent ... schilderen.", answer: "voor" },
                    { question: "De hond luistert ... zijn baasje.", answer: "naar" },
                    { question: "Ik ga ... het buitenland.", answer: "naar" },
                    { question: "Zij spreekt ... haar vader.", answer: "met" },
                    { question: "De foto hangt ... de muur.", answer: "aan" },
                    { question: "Hij is geboren ... 1990.", answer: "in" },
                    { question: "De film begint ... acht uur.", answer: "om" },
                    { question: "Ik ben ... een kwartier klaar.", answer: "over" },
                    { question: "De jongen rent ... de hond.", answer: "achter" },
                    { question: "We wachten ... de regen stopt.", answer: "tot" },
                    { question: "Hij kijkt ... de hoek.", answer: "om" },
                    { question: "Ik reis ... de trein.", answer: "met" }
                ]
            },
            'zinsontleding': { // Sentence Analysis
                title: "Grammatica: Zinsontleding",
                description: "Vul het ontbrekende woord in om de zin compleet te maken.",
                sentences: [
                    { question: "Mijn broer en ik ... in de tuin.", answer: "spelen" },
                    { question: "... zijn heel snel.", answer: "zij" },
                    { question: "De jongen ... met zijn bal.", answer: "speelt" },
                    { question: "... gaan naar de film.", answer: "wij" },
                    { question: "Het kind ... vrolijk.", answer: "lacht" },
                    { question: "De zon ... fel.", answer: "schijnt" },
                    { question: "Het meisje ... de bloemen.", answer: "plukt" },
                    { question: "De auto ... hard.", answer: "rijdt" },
                    { question: "Mijn ouders ... thuis.", answer: "zijn" },
                    { question: "De kat ... zachtjes.", answer: "miauwt" },
                    { question: "Wij ... een cake.", answer: "bakken" },
                    { question: "Jij ... de krant.", answer: "leest" },
                    { question: "Ik ... een liedje.", answer: "zing" },
                    { question: "De vogel ... een nestje.", answer: "bouwt" },
                    { question: "Het water ... de rivier.", answer: "stroomt" },
                    { question: "De leraar ... de studenten.", answer: "helpt" },
                    { question: "De hond ... met zijn staart.", answer: "kwispelt" },
                    { question: "De bloem ... mooi.", answer: "groeit" },
                    { question: "De kinderen ... op het plein.", answer: "spelen" },
                    { question: "De jongen ... een verhaal.", answer: "schrijft" },
                    { question: "De wind ... door de bomen.", answer: "waait" },
                    { question: "Ik ... een boek.", answer: "lees" },
                    { question: "De bakker ... brood.", answer: "bakt" },
                    { question: "De schilder ... een portret.", answer: "schildert" },
                    { question: "De bloemist ... een boeket.", answer: "maakt" },
                    { question: "De kok ... soep.", answer: "kookt" },
                    { question: "De visser ... een vis.", answer: "vangt" },
                    { question: "De chauffeur ... de bus.", answer: "bestuurt" },
                    { question: "De boer ... het land.", answer: "ploegt" },
                    { question: "De timmerman ... een tafel.", answer: "maakt" },
                    { question: "De hond ... hard.", answer: "rent" },
                    { question: "De kat ... zachtjes.", answer: "slaapt" },
                    { question: "De zangeres ... prachtig.", answer: "zingt" },
                    { question: "De student ... de les.", answer: "volgt" },
                    { question: "De postbode ... de post.", answer: "bezorgt" },
                    { question: "De brandweerman ... het vuur.", answer: "blust" },
                    { question: "De verpleegkundige ... de pati√´nt.", answer: "verzorgt" },
                    { question: "De tuinman ... de planten.", answer: "geeft water aan" },
                    { question: "De arts ... de zieke mensen.", answer: "geneest" },
                    { question: "De schrijver ... een nieuw boek.", answer: "schrijft" },
                    { question: "De leraar ... de klas.", answer: "onderwijst" },
                    { question: "De piloot ... het vliegtuig.", answer: "vliegt" },
                    { question: "De politieagent ... de dief.", answer: "arresteert" },
                    { question: "De leeuw ... op zijn prooi.", answer: "jaagt" },
                    { question: "Het paard ... over het veld.", answer: "galoppeert" },
                    { question: "De robot ... de vloer.", answer: "veegt" },
                    { question: "De astronaut ... in de ruimte.", answer: "zweeft" },
                    { question: "De boeken ... in de kast.", answer: "staan" },
                    { question: "De film ... om acht uur.", answer: "begint" },
                    { question: "De zon ... 's ochtends.", answer: "komt op" },
                    { question: "De auto ... aan het einde van de straat.", answer: "staat" },
                    { question: "De kat ... over het hek.", answer: "springt" },
                    { question: "De vogel ... in de boom.", answer: "zong" },
                    { question: "Het kind ... zijn huiswerk.", answer: "maakt" }
                ]
            },
            'spelling': { // Spelling
                title: "Spelling: Moeilijke woorden",
                description: "Spel het woord correct.",
                words: [
                    'onmiddellijk', 'enthousiast', 'enthousiasme', 'onvergetelijk', 'ingewikkeld',
                    'afhankelijk', 'onafhankelijk', 'tegenwoordig', 'onweerstaanbaar', 'verrassing',
                    'verrassend', 'verzamelen', 'veranderlijk', 'voortdurend', 'verantwoordelijkheid',
                    'onuitputtelijk', 'uiteindelijk', 'waarschijnlijk', 'onvoorstelbaar', 'belangrijk',
                    'mogelijkheid', 'werkelijkheid', 'gezelligheid', 'aannemelijk', 'onuitvoerbaar',
                    'afzonderlijk', 'uitzonderlijk', 'vervelend', 'afgelopen', 'gewoonlijk',
                    'ongebruikelijk', 'opmerkelijk', 'vrijwillig', 'onmiddellijke', 'onoverwinnelijk',
                    'aanvaardbaar', 'onuitspreekbaar', 'uitvoerbaar', 'onverstaanbaar', 'tegenstrijdig',
                    'ontzettend', 'uitzonderlijk', 'onverantwoordelijk', 'onverantwoord', 'onweerstaanbaar',
                    'onvoorzien', 'uitzonderingen', 'onafhankelijkheid', 'onuitputtelijk', 'onwillekeurig'
                ]
            },
            'meervoud': { // Plural
                title: "Grammatica: Meervoud",
                description: "Geef het meervoud van het woord.",
                words: [
                    { singular: 'huis', plural: 'huizen' }, { singular: 'stoel', plural: 'stoelen' },
                    { singular: 'kind', plural: 'kinderen' }, { singular: 'boom', plural: 'bomen' },
                    { singular: 'boek', plural: 'boeken' }, { singular: 'tafel', plural: 'tafels' },
                    { singular: 'stad', plural: 'steden' }, { singular: 'ei', plural: 'eieren' },
                    { singular: 'mes', plural: 'messen' }, { singular: 'lepel', plural: 'lepels' },
                    { singular: 'broek', plural: 'broeken' }, { singular: 'jas', plural: 'jassen' },
                    { singular: 'telefoon', plural: 'telefoons' }, { singular: 'hand', plural: 'handen' },
                    { singular: 'vogel', plural: 'vogels' }, { singular: 'dier', plural: 'dieren' },
                    { singular: 'school', plural: 'scholen' }, { singular: 'leraar', plural: 'leraren' },
                    { singular: 'leerling', plural: 'leerlingen' }, { singular: 'muis', plural: 'muizen' },
                    { singular: 'dorp', plural: 'dorpen' }, { singular: 'bloem', plural: 'bloemen' },
                    { singular: 'schoen', plural: 'schoenen' }, { singular: 'tas', plural: 'tassen' },
                    { singular: 'doos', plural: 'dozen' }, { singular: 'krant', plural: 'kranten' },
                    { singular: 'stoel', plural: 'stoelen' }, { singular: 'brug', plural: 'bruggen' },
                    { singular: 'appel', plural: 'appels' }, { singular: 'banaan', plural: 'bananen' },
                    { singular: 'ziekenhuis', plural: 'ziekenhuizen' }, { singular: 'vrouw', plural: 'vrouwen' },
                    { singular: 'man', plural: 'mannen' }, { singular: 'fiets', plural: 'fietsen' },
                    { singular: 'kind', plural: 'kinderen' }, { singular: 'lamp', plural: 'lampen' },
                    { singular: 'tijd', plural: 'tijden' }, { singular: 'deur', plural: 'deuren' },
                    { singular: 'raam', plural: 'ramen' }, { singular: 'auto', plural: 'auto\'s' },
                    { singular: 'foto', plural: 'foto\'s' }, { singular: 'video', plural: 'video\'s' },
                    { singular: 'hobby', plural: 'hobby\'s' }, { singular: 'baby', plural: 'baby\'s' },
                    { singular: 'bureau', plural: 'bureaus' }, { singular: 'cafe', plural: 'cafe' },
                    { singular: 'twee', plural: 'twee√´n' }, { singular: 'drie', plural: 'drie√´n' }
                ]
            },
            'verkleinwoorden': { // Diminutives
                title: "Grammatica: Verkleinwoorden",
                description: "Geef het verkleinwoord van het woord.",
                words: [
                    { base: 'huis', diminutive: 'huisje' }, { base: 'stoel', diminutive: 'stoeltje' },
                    { base: 'kind', diminutive: 'kindje' }, { base: 'boom', diminutive: 'boompje' },
                    { base: 'boek', diminutive: 'boekje' }, { base: 'tafel', diminutive: 'tafeltje' },
                    { base: 'stad', diminutive: 'stadje' }, { base: 'ei', diminutive: 'eitje' },
                    { base: 'mes', diminutive: 'mesje' }, { base: 'lepel', diminutive: 'lepeltje' },
                    { base: 'broek', diminutive: 'broekje' }, { base: 'jas', diminutive: 'jasje' },
                    { base: 'telefoon', diminutive: 'telefoontje' }, { base: 'hand', diminutive: 'handje' },
                    { base: 'vogel', diminutive: 'vogeltje' }, { base: 'dier', diminutive: 'diertje' },
                    { base: 'school', diminutive: 'schooltje' }, { base: 'leraar', diminutive: 'leraartje' },
                    { base: 'leerling', diminutive: 'leerlingetje' }, { base: 'muis', diminutive: 'muisje' },
                    { base: 'dorp', diminutive: 'dorpje' }, { base: 'bloem', diminutive: 'bloempje' },
                    { base: 'schoen', diminutive: 'schoentje' }, { base: 'tas', diminutive: 'tasje' },
                    { base: 'doos', diminutive: 'doosje' }, { base: 'krant', diminutive: 'krantje' },
                    { base: 'glas', diminutive: 'glaasje' }, { base: 'pad', diminutive: 'paadje' },
                    { base: 'been', diminutive: 'beentje' }, { base: 'boom', diminutive: 'boompje' },
                    { base: 'bloem', diminutive: 'bloempje' }, { base: 'fiets', diminutive: 'fietsje' },
                    { base: 'lamp', diminutive: 'lampje' }, { base: 'ring', diminutive: 'ringetje' },
                    { base: 'ring', diminutive: 'ringetje' }, { base: 'tong', diminutive: 'tongetje' },
                    { base: 'vlieg', diminutive: 'vliegje' }, { base: 'pen', diminutive: 'pennetje' },
                    { base: 'bal', diminutive: 'balletje' }, { base: 'man', diminutive: 'mannetje' },
                    { base: 'zon', diminutive: 'zonnetje' }, { base: 'kat', diminutive: 'katje' },
                    { base: 'pop', diminutive: 'popje' }, { base: 'muur', diminutive: 'muurtje' },
                    { base: 'bed', diminutive: 'bedje' }, { base: 'blad', diminutive: 'blaadje' }
                ]
            },
            'idiomen': { // Idioms
                title: "Woordenschat: Idiomen en Spreekwoorden",
                description: "Vul het ontbrekende woord in om het idioom compleet te maken.",
                idioms: [
                    { question: "De kat uit de ... kijken.", answer: "boom" },
                    { question: "Dat is een druppel op een gloeiende ...", answer: "plaat" },
                    { question: "Oost, west, thuis ... best.", answer: "thuis" },
                    { question: "Alle begin is ...", answer: "moeilijk" },
                    { question: "De appel valt niet ver ... de boom.", answer: "van" },
                    { question: "Zo trots als een ...", answer: "pauw" },
                    { question: "Zo sluw als een ...", answer: "vos" },
                    { question: "Zo sterk als een ...", answer: "beer" },
                    { question: "Nu komt de aap uit de ...", answer: "mouw" },
                    { question: "Een speld in een ... zoeken.", answer: "hooiberg" },
                    { question: "Een hekel aan iemand hebben.", answer: "hekel" },
                    { question: "Een vogel in de hand is beter dan tien ... in de lucht.", answer: "in" },
                    { question: "Het beste paard van ...", answer: "stal" },
                    { question: "Met de noorderzon ...", answer: "vertrokken" },
                    { question: "Iets onder de knie hebben.", answer: "onder" },
                    { question: "De puntjes op de ... zetten.", answer: "i" },
                    { question: "In de ... van je leven.", answer: "bloei" },
                    { question: "In de wolken zijn.", answer: "in" },
                    { question: "Een ... op het oog hebben.", answer: "knipoog" },
                    { question: "De kogel is door de ...", answer: "kerk" }
                ]
            },
            'woordsoorten': { // Parts of Speech
                title: "Grammatica: Woordsoorten",
                description: "Welke woordsoort is het dikgedrukte woord?",
                questions: [
                    { sentence: "De <b>rode</b> auto rijdt snel.", answer: "bijvoeglijk naamwoord" },
                    { sentence: "Ik <b>loop</b> naar huis.", answer: "werkwoord" },
                    { sentence: "<b>De</b> hond rent hard.", answer: "lidwoord" },
                    { sentence: "Hij is een <b>jongen</b>.", answer: "zelfstandig naamwoord" },
                    { sentence: "Ik eet een appel <b>en</b> een peer.", answer: "voegwoord" },
                    { sentence: "De jongen <b>rent</b> snel.", answer: "werkwoord" },
                    { sentence: "De <b>kat</b> ligt op de bank.", answer: "zelfstandig naamwoord" },
                    { sentence: "Zij <b>gaat</b> naar school.", answer: "werkwoord" },
                    { sentence: "De <b>boeken</b> staan in de kast.", answer: "zelfstandig naamwoord" },
                    { sentence: "De <b>mooie</b> bloem groeit.", answer: "bijvoeglijk naamwoord" },
                    { sentence: "De <b>snel</b> loper wint.", answer: "bijwoord" },
                    { sentence: "Hij zingt <b>prachtig</b>.", answer: "bijwoord" },
                    { sentence: "Ik drink <b>een</b> kopje thee.", answer: "lidwoord" },
                    { sentence: "De kinderen spelen <b>in</b> de tuin.", answer: "voorzetsel" },
                    { sentence: "<b>Zij</b> is mijn zus.", answer: "persoonlijk voornaamwoord" },
                    { sentence: "Dat is <b>mijn</b> fiets.", answer: "bezittelijk voornaamwoord" },
                    { sentence: "<b>Wie</b> is daar?", answer: "vraagwoord" },
                    { sentence: "<b>Het</b> regent hard.", answer: "persoonlijk voornaamwoord" },
                    { sentence: "De <b>grote</b> hond blaft.", answer: "bijvoeglijk naamwoord" },
                    { sentence: "Hij wandelt <b>door</b> het park.", answer: "voorzetsel" }
                ]
            },
            'ontkenningen': { // Negations
                title: "Grammatica: Ontkenningen",
                description: "Maak de zin negatief door 'niet' of 'geen' in te vullen.",
                questions: [
                    { question: "Ik heb ... tijd.", answer: "geen" },
                    { question: "Zij spreekt ... met hem.", answer: "niet" },
                    { question: "Hij heeft ... huisdier.", answer: "geen" },
                    { question: "Wij gaan ... naar school.", answer: "niet" },
                    { question: "Er is ... melk meer in de koelkast.", answer: "geen" },
                    { question: "Ik geloof het ...", answer: "niet" },
                    { question: "De leraar geeft ... huiswerk.", answer: "geen" },
                    { question: "Zij is ... bang.", answer: "niet" },
                    { question: "Ik heb ... geld op zak.", answer: "geen" },
                    { question: "Hij heeft ... zin om te studeren.", answer: "geen" },
                    { question: "We hebben ... fruit meer.", answer: "geen" },
                    { question: "Ik ben ... tevreden.", answer: "niet" },
                    { question: "De leraar is ... in de klas.", answer: "niet" },
                    { question: "De kinderen hebben ... koekjes.", answer: "geen" },
                    { question: "Hij is ... getrouwd.", answer: "niet" },
                    { question: "Het heeft ... geregend.", answer: "niet" },
                    { question: "Zij heeft ... broers of zussen.", answer: "geen" },
                    { question: "Ik heb ... honger.", answer: "geen" },
                    { question: "Hij wil ... naar de film.", answer: "niet" },
                    { question: "We hebben ... tijd om te rusten.", answer: "geen" }
                ]
            },
            'bonus_question': {
                title: "Bonusvraag!",
                description: "Beantwoord deze vraag correct en verdien 20 punten!",
                questions: [
                    { question: "Welke Nederlandse rivier mondt uit in de Noordzee bij Hoek van Holland?", answer: "Nieuwe Waterweg" },
                    { question: "Hoe heet het grootste eiland van de Waddeneilanden?", answer: "Texel" },
                    { question: "Wat is de Nederlandse benaming voor de beroemde Gouden Eeuw?", answer: "Gouden Eeuw" },
                    { question: "Welke kleur staat symbool voor het Nederlands Koningshuis?", answer: "Oranje" },
                    { question: "Hoe heet de windmolen in Amsterdam die tot de hoogste windmolens ter wereld behoort?", answer: "De Gooyer" },
                    { question: "Wat is de bijnaam van Amsterdam?", answer: "Mokum" },
                    { question: "Welk Nederlands gerecht wordt traditioneel gegeten met stamppot?", answer: "worst" },
                    { question: "In welke stad staat het Vrijthof?", answer: "Maastricht" },
                    { question: "Hoeveel provincies telt Nederland?", answer: "12" },
                    { question: "Wat is de hoofdstad van Nederland?", answer: "Amsterdam" },
                    { question: "In welke Nederlandse provincie ligt de stad 's-Hertogenbosch?", answer: "Noord-Brabant" },
                    { question: "Welk dier staat centraal in het spreekwoord 'Een ezel stoot zich geen twee keer aan dezelfde steen'?", answer: "ezel" },
                    { question: "Hoe heet het gebouw in Den Haag waar de Nederlandse regering vergadert?", answer: "Binnenhof" },
                    { question: "Wat is de naam van de Nederlandse nationale luchthaven?", answer: "Schiphol" },
                    { question: "Welk kunstwerk van Rembrandt is het bekendst?", answer: "Nachtwacht" },
                    { question: "Hoe heet de dam die het IJsselmeer van de Waddenzee scheidt?", answer: "Afsluitdijk" },
                    { question: "Wat is de naam van de bekende Nederlandse schilder die landschappen maakte met windmolens?", answer: "Mondriaan" },
                    { question: "Welk Nederlands gerecht bestaat uit aardappelen, groenten en vlees?", answer: "stamppot" },
                    { question: "Hoe heet de grootste Nederlandse haven?", answer: "Rotterdamse haven" },
                    { question: "Welke Nederlandse stad wordt ook wel de 'Lichtstad' genoemd?", answer: "Eindhoven" }
                ]
            }
        };

        const subjects = ['ik', 'jij', 'hij', 'zij', 'wij', 'jullie', 'zij'];

        // Utility function to get a random item from an array
        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // Function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Function to create quiz questions for Tegenwoordige Tijd (Present Tense)
        function createTTQuiz() {
            const verbstem = getRandomItem(quizData.tt.verbstems);
            const questionVerb = verbstem.substring(0, verbstem.length - 2);
            let subject = getRandomItem(subjects);
            let ending = '';

            if (subject === 'ik' || subject === 'jij' || subject === 'hij' || subject === 'zij') {
                ending = 't';
            } else if (subject === 'jullie' || subject === 'wij' || subject === 'zij') {
                ending = 'en';
            }

            const answer = questionVerb + ending;
            const fullSentence = `${subject.charAt(0).toUpperCase() + subject.slice(1)} ... naar de markt. (werkwoord: ${verbstem})`;
            return [{ question: fullSentence, answer: answer }];
        }

        // Function to create quiz questions for Verleden Tijd (Past Tense)
        function createVTQuiz() {
            const verb = getRandomItem(quizData.vt.verbs);
            const subject = getRandomItem(subjects);
            const questionSentence = `${subject.charAt(0).toUpperCase() + subject.slice(1)} ... naar een film. (werkwoord: ${verb.inf})`;
            return [{ question: questionSentence, answer: verb.vt }];
        }

        // Function to create quiz questions for Voltooid Deelwoord (Past Participle)
        function createVDQuiz() {
            const verb = getRandomItem(quizData.vd.verbs);
            const subject = getRandomItem(subjects);
            const questionSentence = `${subject.charAt(0).toUpperCase() + subject.slice(1)} heeft ... van het boek. (werkwoord: ${verb.inf})`;
            return [{ question: questionSentence, answer: verb.vd }];
        }

        // Function to create quiz questions for Forzetsels (Prepositions)
        function createVoorzetselsQuiz() {
            const sentence = getRandomItem(quizData.voorzetsels.sentences);
            return [{ question: sentence.question, answer: sentence.answer }];
        }

        // Function to create quiz questions for Spelling
        function createSpellingQuiz() {
            const word = getRandomItem(quizData.spelling.words);
            return [{ question: `Spel het woord: ${word.substring(0, word.length - 2)}...`, answer: word }];
        }

        // Function to create quiz questions for Meervoud (Plural)
        function createMeervoudQuiz() {
            const word = getRandomItem(quizData.meervoud.words);
            return [{ question: `Wat is het meervoud van: ${word.singular}?`, answer: word.plural }];
        }

        // Function to create quiz questions for Verkleinwoorden (Diminutives)
        function createVerkleinwoordenQuiz() {
            const word = getRandomItem(quizData.verkleinwoorden.words);
            return [{ question: `Wat is het verkleinwoord van: ${word.base}?`, answer: word.diminutive }];
        }

        // Function to create quiz questions for Idiomen (Idioms)
        function createIdiomenQuiz() {
            const idiom = getRandomItem(quizData.idiomen.idioms);
            return [{ question: `Vul aan: ${idiom.question}`, answer: idiom.answer }];
        }

        // Function to create quiz questions for Woordsoorten (Parts of Speech)
        function createWoordsoortenQuiz() {
            const question = getRandomItem(quizData.woordsoorten.questions);
            return [{ question: `Welke woordsoort is het vetgedrukte woord? ${question.sentence}`, answer: question.answer }];
        }

        // Function to create quiz questions for Ontkenningen (Negations)
        function createOntkenningenQuiz() {
            const question = getRandomItem(quizData.ontkenningen.questions);
            return [{ question: `Vul 'niet' of 'geen' in: ${question.question}`, answer: question.answer }];
        }

        // Function to create a bonus question
        function createBonusQuestion() {
            const question = getRandomItem(quizData.bonus_question.questions);
            return [{ question: question.question, answer: question.answer }];
        }


        // Function to get quiz data based on category
        function getQuizData(category) {
            switch (category) {
                case 'tt':
                    return createTTQuiz();
                case 'vt':
                    return createVTQuiz();
                case 'vd':
                    return createVDQuiz();
                case 'voorzetsels':
                    return createVoorzetselsQuiz();
                case 'zinsontleding':
                    return [getRandomItem(quizData.zinsontleding.sentences)];
                case 'spelling':
                    return createSpellingQuiz();
                case 'meervoud':
                    return createMeervoudQuiz();
                case 'verkleinwoorden':
                    return createVerkleinwoordenQuiz();
                case 'idiomen':
                    return createIdiomenQuiz();
                case 'woordsoorten':
                    return createWoordsoortenQuiz();
                case 'ontkenningen':
                    return createOntkenningenQuiz();
                case 'bonus_question':
                    return createBonusQuestion();
                default:
                    return [{ question: "Geen categorie gevonden.", answer: "" }];
            }
        }

        // Function to start a new quiz task
        function startNewTask(category) {
            hideAllScreens();
            const quizContent = getQuizData(category);
            currentTaskAnswers = quizContent.map(q => q.answer.toLowerCase());

            const taskContentDiv = document.getElementById('task-content');
            taskContentDiv.innerHTML = '';
            currentTaskInputs = [];

            document.getElementById('task-title').textContent = quizData[category].title;
            document.getElementById('task-description').textContent = quizData[category].description;

            quizContent.forEach((item, index) => {
                const quizItem = document.createElement('div');
                quizItem.className = 'quiz-item';
                quizItem.innerHTML = `
                    <label for="input-${index}">${item.question}</label>
                    <input type="text" id="input-${index}" placeholder="Vul je antwoord in">
                    <span id="feedback-${index}" class="feedback"></span>
                `;
                taskContentDiv.appendChild(quizItem);
                currentTaskInputs.push(document.getElementById(`input-${index}`));
            });

            document.getElementById('task-content').style.display = 'block';
            document.getElementById('task-buttons').style.display = 'flex';
        }

        // Function to check the answers of the current task
        function checkCurrentTask() {
            let allCorrect = true;
            let pointsGained = 0;

            currentTaskInputs.forEach((input, index) => {
                const feedbackSpan = document.getElementById(`feedback-${index}`);
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = currentTaskAnswers[index];

                if (userAnswer === correctAnswer) {
                    feedbackSpan.textContent = 'Correct!';
                    feedbackSpan.className = 'feedback correct';
                    pointsGained++;
                } else {
                    feedbackSpan.textContent = `Fout. Het correcte antwoord is: ${correctAnswer}`;
                    feedbackSpan.className = 'feedback incorrect';
                    allCorrect = false;
                }
            });

            // If all answers are correct, add points
            if (allCorrect) {
                const bonusPoints = pointsGained * pointDoublerStacks;
                const totalPoints = pointsGained + bonusPoints;
                updatePoints(totalPoints);
                showMessageBox('Goed gedaan!', `Al je antwoorden zijn correct! Je hebt ${pointsGained} punten verdiend. ` + (pointDoublerStacks > 0 ? `Je puntenverdubbelaar heeft je nog eens ${bonusPoints} extra punten gegeven!` : ''));
            } else {
                showMessageBox('Niet alle antwoorden zijn correct.', `Je hebt ${pointsGained} van de ${currentTaskAnswers.length} vragen correct beantwoord.`);
            }
        }

        // Function to show category selection screen
        function showCategorySelection() {
            document.getElementById('task-content').style.display = 'none';
            document.getElementById('task-buttons').style.display = 'none';
            document.getElementById('category-selection').style.display = 'grid';
            document.getElementById('task-title').textContent = 'Begin een taak!';
            document.getElementById('task-description').textContent = 'Klik op een categorie om te beginnen met oefenen!';
        }

        // Function to show a custom message box
        function showMessageBox(title, message) {
            document.getElementById('message-box-title').textContent = title;
            document.getElementById('message-box-text').textContent = message;
            document.getElementById('message-box-overlay').style.display = 'block';
            document.getElementById('message-box').style.display = 'block';
        }

        // Function to close the message box
        function closeMessageBox() {
            document.getElementById('message-box-overlay').style.display = 'none';
            document.getElementById('message-box').style.display = 'none';
        }

        // Function to buy an item from the shop
        function buyItem(item, cost) {
            if (points >= cost) {
                updatePoints(-cost);
                switch (item) {
                    case 'badge':
                        if (!badgeUnlocked) {
                            badgeUnlocked = true;
                            unlockedItems.push('Digitale Badge "Grammatica Expert"');
                            updateStatus('badge', 'Ontgrendeld!');
                            showMessageBox('Gekocht!', 'Je hebt de digitale badge "Grammatica Expert" gekocht!');
                        } else {
                            showMessageBox('Al Gekocht', 'Je hebt deze badge al ontgrendeld.');
                        }
                        break;
                    case 'joke':
                        jokeUnlocked = true;
                        const joke = getRandomItem([
                            "Wat is het toppunt van geduld? Wachten op een ezel die de trap op loopt.",
                            "Wat is het verschil tussen een lepel en een theelepel? Een lepel is groter dan een theelepel.",
                            "Wat is de favoriete film van een bakker? De ringen van de broodheer."
                        ]);
                        document.getElementById('joke-content').textContent = joke;
                        document.getElementById('joke-content').style.display = 'block';
                        showMessageBox('Gekocht!', 'Hier is een mop: ' + joke);
                        break;
                    case 'doubler':
                        pointDoublerStacks++;
                        unlockedItems.push('Punten-Verdubbelaar');
                        updateStatus('doubler', `Actief! Stapels: ${pointDoublerStacks}`);
                        showMessageBox('Gekocht!', 'De puntenverdubbelaar is nu actief! Je verdient dubbele punten voor de volgende quiz.');
                        break;
                    case 'sticker':
                        stickerUnlocked = true;
                        unlockedItems.push('Virtuele Sticker "Goed Bezig!"');
                        updateStatus('sticker', 'Ontgrendeld!');
                        showMessageBox('Gekocht!', 'Je hebt de virtuele sticker "Goed Bezig!" gekocht!');
                        break;
                    case 'bonus_question':
                        startNewTask('bonus_question');
                        bonusQuestionUnlocked = true;
                        updateStatus('bonus_question', 'Klaar!');
                        break;
                }
                saveUserData(); // Save changes after purchase
                renderUnlockedItems();
            } else {
                showMessageBox('Onvoldoende punten', 'Je hebt niet genoeg punten om dit item te kopen.');
            }
        }

        // Function to update the status of an item in the shop
        function updateStatus(item, status) {
            const statusElement = document.getElementById(`${item}-status`);
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.className = 'unlocked';
            }
        }

        // Function to render unlocked items in the dedicated section
        function renderUnlockedItems() {
            const list = document.getElementById('unlocked-items-list');
            list.innerHTML = '';
            if (unlockedItems.length > 0) {
                unlockedItems.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.textContent = item;
                    list.appendChild(listItem);
                });
                document.getElementById('unlocked-items-section').style.display = 'block';
            } else {
                document.getElementById('unlocked-items-section').style.display = 'none';
            }
        }

        // Function to update user's points and display
        function updatePoints(amount) {
            points += amount;
            document.getElementById('points-value').textContent = points;
            saveUserData();
        }

        // Function to hide all quiz screens and show the category selection
        function hideAllScreens() {
            document.getElementById('category-selection').style.display = 'none';
            document.getElementById('task-content').style.display = 'none';
            document.getElementById('task-buttons').style.display = 'none';
        }

        // Firebase Initialization and User Data Handling
        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Initialize Firebase services and set up auth listener
        function initializeFirebase() {
            if (Object.keys(firebaseConfig).length > 0) {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-id').textContent = userId;
                        userDocRef = doc(db, `artifacts/${appId}/users/${userId}/data`, 'profile');
                        isAuthReady = true;
                        loadUserData();
                    } else {
                        // Sign in anonymously if no custom token is available
                        if (!initialAuthToken) {
                            try {
                                const anonUserCred = await signInAnonymously(auth);
                                userId = anonUserCred.user.uid;
                                document.getElementById('user-id').textContent = userId;
                                userDocRef = doc(db, `artifacts/${appId}/users/${userId}/data`, 'profile');
                                isAuthReady = true;
                                loadUserData();
                            } catch (error) {
                                console.error("Anonymous sign-in failed:", error);
                            }
                        }
                    }
                });

                // Sign in with custom token if available
                if (initialAuthToken) {
                    signInWithCustomToken(auth, initialAuthToken).catch((error) => {
                        console.error("Custom token sign-in failed:", error);
                    });
                }
            } else {
                console.error("Firebase config is not provided.");
            }
        }

        // Load user data from Firestore
        function loadUserData() {
            if (isAuthReady && userDocRef) {
                onSnapshot(userDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        points = data.points || 0;
                        badgeUnlocked = data.badgeUnlocked || false;
                        jokeUnlocked = data.jokeUnlocked || false;
                        pointDoublerStacks = data.pointDoublerStacks || 0;
                        stickerUnlocked = data.stickerUnlocked || false;
                        unlockedItems = data.unlockedItems || [];
                        
                        document.getElementById('points-value').textContent = points;
                        if (badgeUnlocked) updateStatus('badge', 'Ontgrendeld!');
                        if (jokeUnlocked) updateStatus('joke', 'Ontgrendeld!');
                        if (pointDoublerStacks > 0) updateStatus('doubler', `Actief! Stapels: ${pointDoublerStacks}`);
                        if (stickerUnlocked) updateStatus('sticker', 'Ontgrendeld!');
                        
                        renderUnlockedItems();
                    } else {
                        // If no document exists, create a default one
                        saveUserData();
                    }
                }, (error) => {
                    console.error("Error listening to document changes: ", error);
                });
            } else {
                console.warn("Authentication not ready. Cannot load user data.");
            }
        }

        // Save user data to Firestore
        async function saveUserData() {
            if (isAuthReady && userDocRef) {
                try {
                    const userData = {
                        points,
                        badgeUnlocked,
                        jokeUnlocked,
                        pointDoublerStacks,
                        stickerUnlocked,
                        unlockedItems
                    };
                    await setDoc(userDocRef, userData, { merge: true });
                } catch (e) {
                    console.error("Error writing document: ", e);
                }
            }
        }

        // Initialize the app on window load
        window.onload = function() {
            initializeFirebase();
        };

    </script>
</body>
</html>
